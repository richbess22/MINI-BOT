<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MULLER-MINI - Advanced WhatsApp Bot Management</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --bg-card: rgba(255, 255, 255, 0.05);
            --bg-card-hover: rgba(255, 255, 255, 0.08);
            
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
            --text-muted: rgba(255, 255, 255, 0.6);
            
            --border: rgba(255, 255, 255, 0.1);
            --border-hover: rgba(255, 255, 255, 0.2);
            
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --radius: 12px;
            --radius-lg: 16px;
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-card-hover: rgba(255, 255, 255, 1);
            
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            
            --border: rgba(0, 0, 0, 0.1);
            --border-hover: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 2rem 2rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .nav-menu {
            list-style: none;
            padding: 0 1rem;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius);
            transition: all 0.2s;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Bot Grid */
        .bots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .bot-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .bot-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--border-hover);
        }

        .bot-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .bot-info h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .bot-phone {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .bot-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-connected {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .status-connecting {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .status-disconnected {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .bot-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .bot-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-muted);
            cursor: pointer;
        }

        /* Form */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-switch {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .switch.active {
            background: var(--primary);
        }

        .switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .switch.active::after {
            transform: translateX(26px);
        }

        /* QR Code */
        .qr-container {
            text-align: center;
            padding: 2rem;
        }

        .qr-code {
            max-width: 250px;
            margin: 1rem auto;
            border-radius: var(--radius);
        }

        .pairing-code {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 1rem 0;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            letter-spacing: 2px;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .bots-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-crown"></i>
                    <span>MULLER-MINI</span>
                </div>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="bots">
                            <i class="fas fa-robot"></i>
                            My Bots
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="settings">
                            <i class="fas fa-cog"></i>
                            Settings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Auth Container -->
            <div id="authContainer" class="auth-container">
                <!-- Login Form -->
                <div class="card" id="loginForm" style="max-width: 400px; margin: 2rem auto;">
                    <div class="card-header">
                        <h2 class="card-title">Welcome Back</h2>
                        <button class="theme-toggle" id="themeToggle">
                            <i class="fas fa-moon"></i>
                        </button>
                    </div>

                    <div id="loginAlert"></div>

                    <form id="loginFormElement">
                        <div class="form-group">
                            <label class="form-label" for="loginEmail">Email Address</label>
                            <input type="email" id="loginEmail" class="form-input" placeholder="Enter your email" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password" required>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;" id="loginBtn">
                            <span class="btn-text">Sign In</span>
                            <div class="loading hidden"></div>
                        </button>
                    </form>

                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                        <span style="color: var(--text-secondary);">Don't have an account?</span>
                        <a href="#" style="color: var(--primary); text-decoration: none; font-weight: 600; margin-left: 0.25rem;" id="showRegister">Create Account</a>
                    </div>
                </div>

                <!-- Register Form -->
                <div class="card hidden" id="registerForm" style="max-width: 400px; margin: 2rem auto;">
                    <div class="card-header">
                        <h2 class="card-title">Create Account</h2>
                    </div>

                    <div id="registerAlert"></div>

                    <form id="registerFormElement">
                        <div class="form-group">
                            <label class="form-label" for="registerUsername">Username</label>
                            <input type="text" id="registerUsername" class="form-input" placeholder="Choose a username" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerEmail">Email Address</label>
                            <input type="email" id="registerEmail" class="form-input" placeholder="Enter your email" required>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label" for="registerFirstName">First Name</label>
                                <input type="text" id="registerFirstName" class="form-input" placeholder="First name" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="registerLastName">Last Name</label>
                                <input type="text" id="registerLastName" class="form-input" placeholder="Last name" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerPhone">Phone Number (Optional)</label>
                            <input type="tel" id="registerPhone" class="form-input" placeholder="Enter your phone number">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="registerPassword">Password</label>
                            <input type="password" id="registerPassword" class="form-input" placeholder="Create a password" required>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%;" id="registerBtn">
                            <span class="btn-text">Create Account</span>
                            <div class="loading hidden"></div>
                        </button>
                    </form>

                    <div style="text-align: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                        <span style="color: var(--text-secondary);">Already have an account?</span>
                        <a href="#" style="color: var(--primary); text-decoration: none; font-weight: 600; margin-left: 0.25rem;" id="showLogin">Sign In</a>
                    </div>
                </div>
            </div>

            <!-- Dashboard Pages -->
            <div id="dashboardContainer" class="hidden">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="page-actions">
                            <button class="theme-toggle" id="themeToggleDash">
                                <i class="fas fa-moon"></i>
                            </button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                        <div class="card">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; background: var(--primary); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-robot" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="totalBots">0</div>
                                    <div style="color: var(--text-muted);">Total Bots</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; background: var(--success); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-check-circle" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="activeBots">0</div>
                                    <div style="color: var(--text-muted);">Active Bots</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; background: var(--info); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-paper-plane" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="totalMessages">0</div>
                                    <div style="color: var(--text-muted);">Messages Sent</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 50px; height: 50px; background: var(--warning); border-radius: var(--radius); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-clock" style="color: white; font-size: 1.5rem;"></i>
                                </div>
                                <div>
                                    <div style="font-size: 2rem; font-weight: 700;" id="uptime">0h 0m</div>
                                    <div style="color: var(--text-muted);">Uptime</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Recent Activity</h3>
                        </div>
                        <div id="recentActivity">
                            <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                                <i class="fas fa-clock" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p>No recent activity</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bots Page -->
                <div id="botsPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">My Bots</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" onclick="showCreateBotModal()">
                                <i class="fas fa-plus"></i>
                                Create New Bot
                            </button>
                        </div>
                    </div>

                    <div id="botsContainer">
                        <div class="bots-grid" id="botsGrid">
                            <!-- Bots will be loaded here -->
                        </div>

                        <div class="empty-state" id="emptyBots">
                            <i class="fas fa-robot"></i>
                            <h3>No Bots Yet</h3>
                            <p>Create your first WhatsApp bot to get started</p>
                            <button class="btn btn-primary" onclick="showCreateBotModal()" style="margin-top: 1rem;">
                                <i class="fas fa-plus"></i>
                                Create Your First Bot
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="page hidden">
                    <div class="page-header">
                        <h1 class="page-title">Settings</h1>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Profile Settings</h3>
                        </div>
                        
                        <form id="profileForm">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label" for="profileFirstName">First Name</label>
                                    <input type="text" id="profileFirstName" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="profileLastName">Last Name</label>
                                    <input type="text" id="profileLastName" class="form-input">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="profilePhone">Phone Number</label>
                                <input type="tel" id="profilePhone" class="form-input">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Create Bot Modal -->
    <div class="modal" id="createBotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create New Bot</h3>
                <button class="close-btn" onclick="closeModal('createBotModal')">&times;</button>
            </div>
            
            <div id="createBotAlert"></div>
            
            <form id="createBotForm">
                <div class="form-group">
                    <label class="form-label" for="botName">Bot Name</label>
                    <input type="text" id="botName" class="form-input" placeholder="Enter bot name" value="MULLER-MINI" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="botPhone">Phone Number</label>
                    <input type="tel" id="botPhone" class="form-input" placeholder="+1234567890" required>
                    <small style="color: var(--text-muted);">Include country code (e.g., +1234567890)</small>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('createBotModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Create Bot</span>
                        <div class="loading hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Connect Bot Modal -->
    <div class="modal" id="connectBotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Connect Bot</h3>
                <button class="close-btn" onclick="closeModal('connectBotModal')">&times;</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 2rem;">
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-primary" id="pairCodeBtn">
                        <i class="fas fa-mobile-alt"></i>
                        Pairing Code
                    </button>
                    <button class="btn btn-secondary" id="qrCodeBtn">
                        <i class="fas fa-qrcode"></i>
                        QR Code
                    </button>
                </div>
            </div>
            
            <div id="connectionContent">
                <!-- Connection content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Bot Settings Modal -->
    <div class="modal" id="botSettingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Bot Settings</h3>
                <button class="close-btn" onclick="closeModal('botSettingsModal')">&times;</button>
            </div>
            
            <div id="botSettingsAlert"></div>
            
            <form id="botSettingsForm">
                <div class="form-group">
                    <label class="form-label">Auto View Status</label>
                    <div class="form-switch">
                        <div class="switch" id="autoViewStatus"></div>
                        <span>Automatically view WhatsApp status updates</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Auto Like Status</label>
                    <div class="form-switch">
                        <div class="switch" id="autoLikeStatus"></div>
                        <span>Automatically react to status updates</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Auto Recording</label>
                    <div class="form-switch">
                        <div class="switch" id="autoRecording"></div>
                        <span>Show recording indicator when processing</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Anti Call</label>
                    <div class="form-switch">
                        <div class="switch" id="antiCall"></div>
                        <span>Automatically reject incoming calls</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="botPrefix">Command Prefix</label>
                    <input type="text" id="botPrefix" class="form-input" placeholder="." maxlength="1">
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('botSettingsModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Save Settings</span>
                        <div class="loading hidden"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Global variables
        let currentUser = null;
        let socket = null;
        let currentBots = [];
        let selectedBotId = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            initializeAuth();
            initializeNavigation();
            checkAuthStatus();
        });

        // Theme management
        function initializeTheme() {
            const themeToggles = document.querySelectorAll('.theme-toggle, #themeToggleDash');
            const savedTheme = localStorage.getItem('theme') || 'dark';
            
            setTheme(savedTheme);
            
            themeToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                });
            });
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            
            const themeIcons = document.querySelectorAll('.theme-toggle i');
            themeIcons.forEach(icon => {
                icon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            });
        }

        // Navigation
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link[data-page]');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                    
                    // Update active nav
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showPage(page) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.classList.add('hidden'));
            
            const targetPage = document.getElementById(page + 'Page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                
                // Load page data
                if (page === 'bots') {
                    loadBots();
                } else if (page === 'settings') {
                    loadUserProfile();
                }
            }
        }

        // Authentication
        function initializeAuth() {
            const loginForm = document.getElementById('loginFormElement');
            const registerForm = document.getElementById('registerFormElement');
            const showRegister = document.getElementById('showRegister');
            const showLogin = document.getElementById('showLogin');

            // Form switching
            showRegister.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
            });

            showLogin.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });

            // Login form
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleLogin();
            });

            // Register form
            registerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                await handleRegister();
            });
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            const alert = document.getElementById('loginAlert');

            setLoading(btn, true);
            clearAlert(alert);

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('user', JSON.stringify(data.data.user));
                    currentUser = data.data.user;
                    
                    showAlert(alert, 'Login successful!', 'success');
                    setTimeout(() => showDashboard(), 1000);
                } else {
                    showAlert(alert, data.message || 'Login failed', 'error');
                }
            } catch (error) {
                showAlert(alert, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        async function handleRegister() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const firstName = document.getElementById('registerFirstName').value;
            const lastName = document.getElementById('registerLastName').value;
            const phoneNumber = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const btn = document.getElementById('registerBtn');
            const alert = document.getElementById('registerAlert');

            setLoading(btn, true);
            clearAlert(alert);

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username, email, firstName, lastName, phoneNumber, password
                    })
                });

                const data = await response.json();

                if (data.success) {
                    localStorage.setItem('token', data.data.token);
                    localStorage.setItem('user', JSON.stringify(data.data.user));
                    currentUser = data.data.user;
                    
                    showAlert(alert, 'Account created successfully!', 'success');
                    setTimeout(() => showDashboard(), 1500);
                } else {
                    showAlert(alert, data.message || 'Registration failed', 'error');
                }
            } catch (error) {
                showAlert(alert, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(btn, false);
            }
        }

        function checkAuthStatus() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');

            if (token && user) {
                currentUser = JSON.parse(user);
                showDashboard();
            }
        }

        function showDashboard() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('dashboardContainer').classList.remove('hidden');
            
            initializeSocket();
            loadDashboardData();
            loadBots();
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            currentUser = null;
            if (socket) socket.disconnect();
            
            document.getElementById('dashboardContainer').classList.add('hidden');
            document.getElementById('authContainer').classList.remove('hidden');
        }

        // Socket.IO
        function initializeSocket() {
            socket = io();
            
            socket.on('connect', function() {
                console.log('Connected to server');
                socket.emit('join', `user_${currentUser.id}`);
            });

            socket.on('bot_status_update', function(data) {
                console.log('Bot status update:', data);
                updateBotStatus(data);
            });
        }

        // Dashboard Data
        async function loadDashboardData() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/bot/my-bots', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    updateDashboardStats(data.data);
                }
            } catch (error) {
                console.error('Failed to load dashboard data:', error);
            }
        }

        function updateDashboardStats(bots) {
            const totalBots = bots.length;
            const activeBots = bots.filter(bot => bot.status === 'connected').length;
            const totalMessages = bots.reduce((sum, bot) => sum + (bot.statistics?.messagesSent || 0), 0);
            
            document.getElementById('totalBots').textContent = totalBots;
            document.getElementById('activeBots').textContent = activeBots;
            document.getElementById('totalMessages').textContent = totalMessages.toLocaleString();
        }

        // Bot Management
        async function loadBots() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/bot/my-bots', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                const data = await response.json();
                
                if (data.success) {
                    currentBots = data.data;
                    renderBots(data.data);
                    updateDashboardStats(data.data);
                }
            } catch (error) {
                console.error('Failed to load bots:', error);
            }
        }

        function renderBots(bots) {
            const grid = document.getElementById('botsGrid');
            const empty = document.getElementById('emptyBots');
            
            if (bots.length === 0) {
                grid.style.display = 'none';
                empty.style.display = 'block';
                return;
            }
            
            grid.style.display = 'grid';
            empty.style.display = 'none';
            
            grid.innerHTML = bots.map(bot => `
                <div class="bot-card">
                    <div class="bot-header">
                        <div class="bot-info">
                            <h3>${bot.botName}</h3>
                            <div class="bot-phone">${bot.phoneNumber}</div>
                        </div>
                        <span class="bot-status status-${bot.status}">${bot.status}</span>
                    </div>
                    
                    <div class="bot-stats">
                        <div class="stat">
                            <div class="stat-value">${bot.statistics?.messagesReceived || 0}</div>
                            <div class="stat-label">Received</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${bot.statistics?.messagesSent || 0}</div>
                            <div class="stat-label">Sent</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${bot.statistics?.commandsExecuted || 0}</div>
                            <div class="stat-label">Commands</div>
                        </div>
                    </div>
                    
                    <div class="bot-actions">
                        ${bot.status === 'disconnected' ? 
                            `<button class="btn btn-success btn-sm" onclick="connectBot('${bot.id}')">
                                <i class="fas fa-plug"></i> Connect
                            </button>` : 
                            `<button class="btn btn-warning btn-sm" onclick="disconnectBot('${bot.id}')">
                                <i class="fas fa-unlink"></i> Disconnect
                            </button>`
                        }
                        <button class="btn btn-primary btn-sm" onclick="showBotSettings('${bot.id}')">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteBot('${bot.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Bot Actions
        function showCreateBotModal() {
            document.getElementById('createBotModal').classList.add('active');
        }

        document.getElementById('createBotForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const botName = document.getElementById('botName').value;
            const phoneNumber = document.getElementById('botPhone').value;
            const btn = this.querySelector('button[type="submit"]');
            const alert = document.getElementById('createBotAlert');
            
            setLoading(btn, true);
            clearAlert(alert);
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/bot/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ botName, phoneNumber })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(alert, 'Bot created successfully!', 'success');
                    setTimeout(() => {
                        closeModal('createBotModal');
                        loadBots();
                    }, 1500);
                } else {
                    showAlert(alert, data.message || 'Failed to create bot', 'error');
                }
            } catch (error) {
                showAlert(alert, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(btn, false);
            }
        });

        async function connectBot(botId) {
            selectedBotId = botId;
            document.getElementById('connectBotModal').classList.add('active');
            
            // Setup connection method buttons
            document.getElementById('pairCodeBtn').onclick = () => requestPairingCode(botId);
            document.getElementById('qrCodeBtn').onclick = () => requestQRCode(botId);
            
            // Default to pairing code
            requestPairingCode(botId);
        }

        async function requestPairingCode(botId) {
            const content = document.getElementById('connectionContent');
            content.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading"></div><p>Generating pairing code...</p></div>';
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/bot/pair', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ botId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    content.innerHTML = `
                        <div class="qr-container">
                            <h4>Pairing Code</h4>
                            <div class="pairing-code">${data.data.pairingCode}</div>
                            <p style="color: var(--text-muted); margin-bottom: 1rem;">
                                Enter this code in WhatsApp > Linked Devices > Link a Device
                            </p>
                            <button class="btn btn-secondary" onclick="requestPairingCode('${botId}')">
                                <i class="fas fa-refresh"></i> Generate New Code
                            </button>
                        </div>
                    `;
                } else {
                    content.innerHTML = `<div class="alert alert-error">${data.message}</div>`;
                }
            } catch (error) {
                content.innerHTML = `<div class="alert alert-error">Failed to generate pairing code</div>`;
            }
        }

        async function requestQRCode(botId) {
            const content = document.getElementById('connectionContent');
            content.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading"></div><p>Generating QR code...</p></div>';
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/bot/qr', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ botId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    content.innerHTML = `
                        <div class="qr-container">
                            <h4>QR Code</h4>
                            <img src="${data.data.qrCode}" alt="QR Code" class="qr-code">
                            <p style="color: var(--text-muted); margin-bottom: 1rem;">
                                Scan this QR code with WhatsApp > Linked Devices > Link a Device
                            </p>
                            <button class="btn btn-secondary" onclick="requestQRCode('${botId}')">
                                <i class="fas fa-refresh"></i> Generate New QR
                            </button>
                        </div>
                    `;
                } else {
                    content.innerHTML = `<div class="alert alert-error">${data.message}</div>`;
                }
            } catch (error) {
                content.innerHTML = `<div class="alert alert-error">Failed to generate QR code</div>`;
            }
        }

        function showBotSettings(botId) {
            selectedBotId = botId;
            const bot = currentBots.find(b => b.id === botId);
            
            if (bot) {
                // Populate settings form
                document.getElementById('botPrefix').value = bot.settings?.prefix || '.';
                
                // Set switches
                setSwitch('autoViewStatus', bot.settings?.autoViewStatus !== false);
                setSwitch('autoLikeStatus', bot.settings?.autoLikeStatus !== false);
                setSwitch('autoRecording', bot.settings?.autoRecording !== false);
                setSwitch('antiCall', bot.settings?.antiCall !== false);
                
                document.getElementById('botSettingsModal').classList.add('active');
            }
        }

        document.getElementById('botSettingsForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const settings = {
                prefix: document.getElementById('botPrefix').value,
                autoViewStatus: document.getElementById('autoViewStatus').classList.contains('active'),
                autoLikeStatus: document.getElementById('autoLikeStatus').classList.contains('active'),
                autoRecording: document.getElementById('autoRecording').classList.contains('active'),
                antiCall: document.getElementById('antiCall').classList.contains('active')
            };
            
            const btn = this.querySelector('button[type="submit"]');
            const alert = document.getElementById('botSettingsAlert');
            
            setLoading(btn, true);
            clearAlert(alert);
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`/api/bot/settings/${selectedBotId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert(alert, 'Settings updated successfully!', 'success');
                    setTimeout(() => {
                        closeModal('botSettingsModal');
                        loadBots();
                    }, 1500);
                } else {
                    showAlert(alert, data.message || 'Failed to update settings', 'error');
                }
            } catch (error) {
                showAlert(alert, 'Network error. Please try again.', 'error');
            } finally {
                setLoading(btn, false);
            }
        });

        async function deleteBot(botId) {
            if (!confirm('Are you sure you want to delete this bot? This action cannot be undone.')) {
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`/api/bot/${botId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    loadBots();
                } else {
                    alert('Failed to delete bot: ' + data.message);
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        }

        // User Profile
        async function loadUserProfile() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/user/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const user = data.data;
                    document.getElementById('profileFirstName').value = user.firstName || '';
                    document.getElementById('profileLastName').value = user.lastName || '';
                    document.getElementById('profilePhone').value = user.phoneNumber || '';
                }
            } catch (error) {
                console.error('Failed to load profile:', error);
            }
        }

        document.getElementById('profileForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('profileFirstName').value;
            const lastName = document.getElementById('profileLastName').value;
            const phoneNumber = document.getElementById('profilePhone').value;
            
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ firstName, lastName, phoneNumber })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Profile updated successfully!');
                } else {
                    alert('Failed to update profile: ' + data.message);
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        });

        // Utility Functions
        function setLoading(button, loading) {
            const text = button.querySelector('.btn-text');
            const spinner = button.querySelector('.loading');
            
            if (loading) {
                text.style.display = 'none';
                spinner.classList.remove('hidden');
                button.disabled = true;
            } else {
                text.style.display = 'inline';
                spinner.classList.add('hidden');
                button.disabled = false;
            }
        }

        function showAlert(container, message, type) {
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        }

        function clearAlert(container) {
            container.innerHTML = '';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function setSwitch(switchId, active) {
            const switchEl = document.getElementById(switchId);
            if (active) {
                switchEl.classList.add('active');
            } else {
                switchEl.classList.remove('active');
            }
        }

        // Switch toggle functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('switch')) {
                e.target.classList.toggle('active');
            }
        });

        function updateBotStatus(data) {
            // Update bot status in real-time
            const bot = currentBots.find(b => b.id === data.botId);
            if (bot) {
                bot.status = data.status;
                renderBots(currentBots);
                updateDashboardStats(currentBots);
            }
        }
    </script>
</body>
</html>